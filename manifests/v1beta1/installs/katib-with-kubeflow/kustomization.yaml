apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
namespace: kubeflow
resources:
  # Katib controller.
  - ../../components/controller/controller.yaml
  - ../../components/controller/service.yaml
  - ../../components/controller/rbac.yaml
  - ../../components/controller/katib-config.yaml
  - ../../components/controller/trial-templates.yaml
  # Katib CRDs.
  - ../../components/crd/experiment.yaml
  - ../../components/crd/suggestion.yaml
  - ../../components/crd/trial.yaml
  # Katib DB manager.
  - ../../components/db-manager/db-manager.yaml
  - ../../components/db-manager/service.yaml
  # Katib DB mysql.
  - ../../components/mysql/mysql.yaml
  - ../../components/mysql/service.yaml
  - ../../components/mysql/pv.yaml
  - ../../components/mysql/pvc.yaml
  - ../../components/mysql/secret.yaml
  # Katib UI.
  - ../../components/ui/ui.yaml
  - ../../components/ui/service.yaml
  - ../../components/ui/rbac.yaml
  # Katib webhooks.
  - ../../components/webhook/cert-generator.yaml
  - ../../components/webhook/rbac.yaml
  - ../../components/webhook/webhooks.yaml
  # Kubeflow Katib components.
  - katib-application.yaml
  - kubeflow-katib-roles.yaml
  - ui-virtual-service.yaml
# TODO (andreyvelich): Modify tag to the Katib 0.11 release.
images:
  - name: docker.io/kubeflowkatib/katib-controller
    newTag: v1beta1-c6c9172
    newName: docker.io/kubeflowkatib/katib-controller
  - name: docker.io/kubeflowkatib/katib-db-manager
    newTag: v1beta1-c6c9172
    newName: docker.io/kubeflowkatib/katib-db-manager
  - name: docker.io/kubeflowkatib/katib-ui
    newTag: v1beta1-c6c9172
    newName: docker.io/kubeflowkatib/katib-ui
  - name: docker.io/kubeflowkatib/cert-generator
    newTag: v1beta1-c6c9172
    newName: docker.io/kubeflowkatib/cert-generator
patchesStrategicMerge:
  - |-
    apiVersion: v1
    kind: ConfigMap
    metadata:
      name: katib-config
      namespace: kubeflow
    data:
      metrics-collector-sidecar: |-
        {
          "StdOut": {
            "image": "docker.io/kubeflowkatib/file-metrics-collector:v1beta1-c6c9172"
          },
          "File": {
            "image": "docker.io/kubeflowkatib/file-metrics-collector:v1beta1-c6c9172"
          },
          "TensorFlowEvent": {
            "image": "docker.io/kubeflowkatib/tfevent-metrics-collector:v1beta1-c6c9172",
            "resources": {
              "limits": {
                "memory": "1Gi"
              }
            }
          }
        }
      suggestion: |-
        {
          "random": {
            "image": "docker.io/kubeflowkatib/suggestion-hyperopt:v1beta1-c6c9172"
          },
          "grid": {
            "image": "docker.io/kubeflowkatib/suggestion-chocolate:v1beta1-c6c9172"
          },
          "hyperband": {
            "image": "docker.io/kubeflowkatib/suggestion-hyperband:v1beta1-c6c9172"
          },
          "bayesianoptimization": {
            "image": "docker.io/kubeflowkatib/suggestion-skopt:v1beta1-c6c9172"
          },
          "tpe": {
            "image": "docker.io/kubeflowkatib/suggestion-hyperopt:v1beta1-c6c9172"
          },
          "enas": {
            "image": "docker.io/kubeflowkatib/suggestion-enas:v1beta1-c6c9172",
            "resources": {
              "limits": {
                "memory": "200Mi"
              }
            }
          },
          "cmaes": {
            "image": "docker.io/kubeflowkatib/suggestion-goptuna:v1beta1-c6c9172"
          },
          "darts": {
            "image": "docker.io/kubeflowkatib/suggestion-darts:v1beta1-c6c9172"
          }
        }
      early-stopping: |-
        {
          "medianstop": {
            "image": "docker.io/kubeflowkatib/earlystopping-medianstop:v1beta1-c6c9172"
          }
        }
commonLabels:
  app.kubernetes.io/component: katib
configurations:
  - params.yaml
