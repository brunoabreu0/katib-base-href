# Template run for running e2e tests.

inputs:
  kubernetes-version:
    required: true
    type: string
  experiments:
    required: true
    type: string
  training-operator:
    required: false
    type: boolean

runs:
  using: composite
  steps:
    - name: Set Up Minikube
      uses: manusa/actions-setup-minikube@v2.6.0
      with:
        minikube version: v1.25.2
        kubernetes version: ${{ inputs.kubernetes-version }}
        github token: ${{ env.github_token }}
        driver: docker

    - name: Set Up Docker Buildx
      uses: docker/setup-buildx-action@v1

    - name: Set Up Go env
      uses: actions/setup-go@v2
      with:
        go-version: 1.17.10

    - name: Set Up Minikube Cluster
      shell: bash
      run: ./test/e2e/v1beta1/scripts/gh-actions/setup-minikube.sh

    - name: Set Up Katib
      shell: bash
      run: ./test/e2e/v1beta1/scripts/gh-actions/setup-katib.sh ${{ inputs.training-operator }}

    - name: Run E2E Experiment
      shell: bash
      run: ./test/e2e/v1beta1/scripts/gh-actions/run-e2e-experiment.sh ${{ inputs.experiments }}
